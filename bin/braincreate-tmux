#!/usr/bin/env bash

ROOT="$HOME/Documents/2ndBrain"

cd -- "$ROOT" || { printf 'Error: cannot cd to %s\n' "$ROOT" >&2; exit 1; }

NOTE_OPTIONS=("snippets" "cheatsheet" "school" "full_notes")
USR_CHOICE=$(printf "%s\n" "${NOTE_OPTIONS[@]}" | fzf) || exit 0
export USR_CHOICE

export DATE=$(date +"%Y-%m-%d")

if [[ $USR_CHOICE == "cheatsheet" ]]; then
	read -rp "Enter command/topic: " TITLE || exit 0
	export TITLE
	TEMPLATE="# ${TITLE}

Explanation of command/topic

- Simple usage:
  \` \`

References:

Date: $DATE
Id: $USR_CHOICE"
fi

if [[ $USR_CHOICE = "snippets" ]]; then
	topics=("python" "bash" "cpp" "lua" "go" "sql")
	langchoice=$(printf "%s\n" "${topics[@]}" | fzf) || exit 0
	read -rp "Filename: " TITLE || exit 0
	export TITLE
	TEMPLATE="# ${TITLE}

\`\`\`$langchoice

\`\`\`

References:

Date: $DATE
Id: $USR_CHOICE"
fi

if [[ $USR_CHOICE = "school" ]]; then
	subject=$(
		fd -t d --max-depth 1 . "$ROOT/$USR_CHOICE" --exec basename |
		fzf --bind 'enter:accept-or-print-query') || exit 0
	read -rp "Filename: " TITLE || exit 0
	export TITLE
	TEMPLATE="# ${TITLE}

*Subject: $subject*

## Subheader


Date: $DATE
Id: $USR_CHOICE"
fi

if [[ $USR_CHOICE = "full_notes" ]]; then
	read -rp "Enter command/topic: " TITLE || exit 0
	export TITLE
	TEMPLATE=$(envsubst < "$ROOT/templates/Deep_Understanding_Loop.md")
fi

FNAME="$TITLE.md"
FPATH="$HOME/Documents/2ndBrain/inbox/$FNAME"

printf '%s\n' "$TEMPLATE" >> "$FPATH"
nvim "$FPATH"
